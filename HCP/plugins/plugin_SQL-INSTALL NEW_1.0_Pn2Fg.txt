{
  "referenceId": "Pn2Fg",
  "version": "1.0",
  "name": "SQL-INSTALL NEW",
  "license": "EULA",
  "description": null,
  "baseScript": "$con = 'True'\nwhile ($con -ne $null)\n{\n    $disk = Get-Disk\n    $disks = @()\n    $disks += $disk\n    if (($disks.length) -gt 5) { \n    #Write-Host \"Writing test-1\"\n    Break\n    }\n    Sleep 30\n    }\n#Copy-Item -Path 'C:\\ConfigurationFile-puneet.ini' -Destination 'C:\\test_new.ini'\n$net = new-object -ComObject WScript.Network\n$net.MapNetworkDrive(\"T:\", \"\\\\10.0.1.19\\fs01\\ISO\", $false, \"skygrid\\pmathur\", \"$pass\")\nMount-DiskImage -ImagePath \"T:\\SQLServer2016SP1-FullSlipstream-x64-ENU.iso\" \n$volumes = Get-Volume\nforeach ( $vol in $volumes)\n{\n     if ($vol.FileSystemLabel -match \"SQL2016\")\n      {\n        Write-Host \"Success\"\n        $drive = $vol.DriveLetter\n        Break\n        }\n    }\n    $drive\n    ($drive + \":\\*\")\nif (Test-Path C:\\sql_2016){\n            Copy-Item -Path ($drive + \":\\*\") -Destination C:\\sql_2016 -Recurse\n            Copy-Item -Path T:\\ConfigurationFile-puneet.ini -Destination C:\\test_new.ini\n            }\nelse\n  {\n    md c:\\sql_2016\n    Copy-Item -Path ($drive + \":\\*\") -Destination C:\\sql_2016 -Recurse\n    Copy-Item -Path T:\\ConfigurationFile-puneet.ini -Destination C:\\test_new.ini\n    }    \n    \nDismount-DiskImage -ImagePath \"T:\\SQLServer2016SP1-FullSlipstream-x64-ENU.iso\"\n#$net.RemoveNetworkDrive(\"T:\")\n#Write-Host \"test-2\"\n$partitions = Get-Partition\nforeach ($partition in $partitions)\n\t{\n    \t$paths = $partition.accesspaths\n    \tforeach ($path in $paths)\n    \t\t{\n    \n\t\t\t\tif ($path -like '*DATA1*')\n\t\t\t\t\t{\n\t\t\t\t\t\tRemove-PartitionAccessPath -DiskNumber $partition.DiskNumber -PartitionNumber $partition.PartitionNumber -AccessPath $path\n\t\t\t\t\t\tmd 'C:/mnt/hypercloud/volumes/DATA/DATA1' -ErrorAction SilentlyContinue\n\t\t\t\t\t\tGet-Volume -Partition $partition | Set-Volume -NewFileSystemLabel 'DATA1' -ErrorAction Stop\n\t\t\t\t\t\tAdd-PartitionAccessPath -DiskNumber $partition.DiskNumber -PartitionNumber $partition.PartitionNumber -AccessPath 'C:/mnt/hypercloud/volumes/DATA/DATA1'\n\t\t\t\t\t\tWrite-Host ($path)\n\t\t\t\t\t}\n\t\t\t\tif ($path -like '*DATA2*')\n\t\t\t\t\t{\n\t\t\t\t\t\tRemove-PartitionAccessPath -DiskNumber $partition.DiskNumber -PartitionNumber $partition.PartitionNumber -AccessPath $path\n\t\t\t\t\t\tmd 'C:/mnt/hypercloud/volumes/DATA/DATA2' -ErrorAction SilentlyContinue\n\t\t\t\t\t\tGet-Volume -Partition $partition | Set-Volume -NewFileSystemLabel 'DATA2' -ErrorAction Stop\n\t\t\t\t\t\tAdd-PartitionAccessPath -DiskNumber $partition.DiskNumber -PartitionNumber $partition.PartitionNumber -AccessPath 'C:/mnt/hypercloud/volumes/DATA/DATA2'\n\t\t\t\t\t\tWrite-Host ($path)\n\t\t\t\t\t}\n\t\t\t\tif ($path -like '*DATA3*')\n\t\t\t\t\t{\n\t\t\t\t\t\tRemove-PartitionAccessPath -DiskNumber $partition.DiskNumber -PartitionNumber $partition.PartitionNumber -AccessPath $path\n\t\t\t\t\t\tmd 'C:/mnt/hypercloud/volumes/DATA/DATA3' -ErrorAction SilentlyContinue\n\t\t\t\t\t\tGet-Volume -Partition $partition | Set-Volume -NewFileSystemLabel 'DATA3' -ErrorAction Stop\n\t\t\t\t\t\tAdd-PartitionAccessPath -DiskNumber $partition.DiskNumber -PartitionNumber $partition.PartitionNumber -AccessPath 'C:/mnt/hypercloud/volumes/DATA/DATA3'\n\t\t\t\t\t\tWrite-Host ($path)\n\t\t\t\t\t}\n\t\t\t\tif ($path -like '*DATA4*')\n\t\t\t\t\t{\n\t\t\t\t\t\tRemove-PartitionAccessPath -DiskNumber $partition.DiskNumber -PartitionNumber $partition.PartitionNumber -AccessPath $path\n\t\t\t\t\t\tmd 'C:/mnt/hypercloud/volumes/DATA/DATA4' -ErrorAction SilentlyContinue\n\t\t\t\t\t\tGet-Volume -Partition $partition | Set-Volume -NewFileSystemLabel 'DATA4' -ErrorAction Stop\n\t\t\t\t\t\tAdd-PartitionAccessPath -DiskNumber $partition.DiskNumber -PartitionNumber $partition.PartitionNumber -AccessPath 'C:/mnt/hypercloud/volumes/DATA/DATA4'\n\t\t\t\t\t\tWrite-Host ($path)\n\t\t\t\t\t}\n \n\n\t\t\t}\n\t}\n     \nGet-Volume\n$partitions = $null\n$partitions = Get-Partition\n\t\tforeach ($partition in $partitions)\n\t\t\t{\n    \t\t\t$paths = $partition.accesspaths\n    \t\t\tforeach ($path in $paths)\n    \t\t\t\t{\n                        if ($path -like '*SQLBIN*')\n                            {\n                            $path = $path.TrimEnd(\"\\\")\n                        $NewString = $path\n                        $OldString = 'SQLBIN'\n                            (Get-Content -Path 'C:\\test_new.ini').Replace($OldString,$NewString) | Set-Content -Path 'C:\\test_new.ini'\n                        }\n                        if ($path -like '*BACKUP*')\n                           {\n                           $path = $path.TrimEnd(\"\\\")\n                        $NewString = $path\n                        $OldString = 'BACKUP'\n                            (Get-Content -Path 'C:\\test_new.ini').Replace($OldString,$NewString) | Set-Content -Path 'C:\\test_new.ini'\n            }\n            if (($path -like '*TEMPDB*') -and (-not ($path -like '*TEMPDBLOGS*')))\n    {\n  $path = $path.TrimEnd(\"\\\")\n                        $NewString = $path\n                        $OldString = 'TEMPDBO'\n                        (Get-Content -Path 'C:\\test_new.ini').Replace($OldString,$NewString) | Set-Content -Path 'C:\\test_new.ini'\n                        }\n                        if ($path -like '*TEMPDBLOGS*')\n    {\n     $path = $path.TrimEnd(\"\\\")\n     $NewString = $path\n                        $OldString = 'TEMPDBLOGS'\n                        (Get-Content -Path 'C:\\test_new.ini').Replace($OldString,$NewString) | Set-Content -Path 'C:\\test_new.ini'\n                        }\n                        if ($path -like '*SQLLOGS*')\n    {\n     $path = $path.TrimEnd(\"\\\")\n     $NewString = $path\n                        $OldString = 'SQLLOGS'\n                        (Get-Content -Path 'C:\\test_new.ini').Replace($OldString,$NewString) | Set-Content -Path 'C:\\test_new.ini'\n                        }\n                        }}\n#$proc = Start-Process \"c:\\sql_2016\\setup.exe\" -ArgumentList '/ConfigurationFile=\"C:\\test_new.ini\"' -Wait -PassThru -erroraction stop\n#write-host \"test-3\"\n#if ($proc.exitcode -eq '0')\n#{Write-Host \"SQL installed successfully\"}\nSleep 300\nStart-Process \"c:\\sql_2016\\setup.exe\" -ArgumentList '/ConfigurationFile=\"C:\\test_new.ini\"' -Wait -PassThru -ErrorAction Stop\nGet-Service | where { $_.Name -like '*SQL*'}\n",
  "envs": [
    {
      "prop": "pass",
      "val": "12345",
      "hidden": false,
      "eval": null
    }
  ],
  "scriptArgs": null,
  "scriptLang": "POWERSHELL",
  "timeout": 30
}